esphome:
  name: reterminal-e1001
  friendly_name: reTerminal E1001
  on_boot:
    priority: 600
    then:
      # Turn on the GPIO output that powers the battery measurement circuit
      - output.turn_on: bsp_battery_enable
      # Wait a short delay to allow power stabilization
      - delay: 500ms
      # Manually update battery sensors (voltage and percentage)
      - component.update: battery_voltage
      # Manually read the internal temperature/humidity sensor
      - component.update: sht4x_component
esp32:
  board: esp32-s3-devkitc-1
  framework:
    type: esp-idf

# Enable logging
logger:
  level: DEBUG
# Enable Home Assistant API
api:
  encryption:
    key: "Wd2LBlP8bZOyQhb6TVW04Xe3gGqXMLxPq3jfcdlp5bY="

ota:
  - platform: esphome
    password: "c5ead64cda5dd2db84bcaadd9c43801f"

wifi:
  ssid: !secret wifi_ssid
  password: !secret wifi_password

  # Enable fallback hotspot (captive portal) in case wifi connection fails
  ap:
    ssid: "Reterminal-E1001"
    password: "vCw4lOKV8mqy"

captive_portal:
output:
- platform: gpio
  pin: GPIO21
  id: bsp_battery_enable

time:
  - platform: homeassistant
    id: mon_time

# define I2C interface
i2c:
  sda: GPIO19
  scl: GPIO20
  scan: false

text_sensor:

  # Prevision horaire
  - platform: homeassistant
    name: "Heure0"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure0
    id: heure0

  - platform: homeassistant
    name: "Heure1"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure1
    id: heure1

  - platform: homeassistant
    name: "Heure2"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure2
    id: heure2

  - platform: homeassistant
    name: "Heure3"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure3
    id: heure3

  - platform: homeassistant
    name: "Heure4"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure4
    id: heure4

  - platform: homeassistant
    name: "Heure5"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure5
    id: heure5

  - platform: homeassistant
    name: "Heure6"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure6
    id: heure6

  - platform: homeassistant
    name: "Heure7"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure7
    id: heure7

  - platform: homeassistant
    name: "Heure8"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure8
    id: heure8

  - platform: homeassistant
    name: "Heure9"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure9
    id: heure9

  - platform: homeassistant
    name: "Heure10"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure10
    id: heure10

  - platform: homeassistant
    name: "Heure11"
    entity_id: sensor.meteo_heure_nantes
    attribute: heure11
    id: heure11

  - platform: homeassistant
    name: "Condition0"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition0
    id: condition0

  - platform: homeassistant
    name: "Condition1"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition1
    id: condition1

  - platform: homeassistant
    name: "Condition2"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition2
    id: condition2

  - platform: homeassistant
    name: "Condition3"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition3
    id: condition3

  - platform: homeassistant
    name: "Condition4"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition4
    id: condition4

  - platform: homeassistant
    name: "Condition5"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition5
    id: condition5

  - platform: homeassistant
    name: "Condition6"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition6
    id: condition6

  - platform: homeassistant
    name: "Condition7"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition7
    id: condition7

  - platform: homeassistant
    name: "Condition8"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition8
    id: condition8

  - platform: homeassistant
    name: "Condition9"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition9
    id: condition9

  - platform: homeassistant
    name: "Condition10"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition10
    id: condition10

  - platform: homeassistant
    name: "Condition11"
    entity_id: sensor.meteo_heure_nantes
    attribute: condition11
    id: condition11

  # Prevision quotidienne
  # Prevision horaire
  - platform: homeassistant
    name: "Jour0"
    entity_id: sensor.meteo_jour_nantes
    attribute: jour0
    id: jour0
  - platform: homeassistant
    name: "Jour1"
    entity_id: sensor.meteo_jour_nantes
    attribute: jour1
    id: jour1
  - platform: homeassistant
    name: "Jour2"
    entity_id: sensor.meteo_jour_nantes
    attribute: jour2
    id: jour2
  - platform: homeassistant
    name: "Jour3"
    entity_id: sensor.meteo_jour_nantes
    attribute: jour3
    id: jour3
  - platform: homeassistant
    name: "Jour4"
    entity_id: sensor.meteo_jour_nantes
    attribute: jour4
    id: jour4         
  - platform: homeassistant
    name: "ConditionJ0"
    entity_id: sensor.meteo_jour_nantes
    attribute: condition0
    id: conditionJ0
  - platform: homeassistant
    name: "ConditionJ1"
    entity_id: sensor.meteo_jour_nantes
    attribute: condition1
    id: conditionJ1
  - platform: homeassistant
    name: "ConditionJ2"
    entity_id: sensor.meteo_jour_nantes
    attribute: condition2
    id: conditionJ2
  - platform: homeassistant
    name: "ConditionJ3"
    entity_id: sensor.meteo_jour_nantes
    attribute: condition3
    id: conditionJ3
  - platform: homeassistant
    name: "ConditionJ4"
    entity_id: sensor.meteo_jour_nantes
    attribute: condition4
    id: conditionJ4           


sensor:
  # ADC for battery voltage measurement
  - platform: adc
    pin: GPIO1
    name: "Battery Voltage"
    id: battery_voltage
    update_interval: never      # Disable automatic updates (manual read only)
    attenuation: 12db
    filters:
      - multiply: 2.0  # Voltage divider compensation

  # Internal SHT4x temperature/humidity sensor
  - platform: sht4x            # Sensor platform
    id: sht4x_component         # ID for the component
    temperature:                # Temperature sensor
      name: "Temperature"       # Sensor name
      id: sht4x_temperature     # ID for temperature sensor
    humidity:                   # Humidity sensor
      name: "Humidity"          # Sensor name
      id: sht4x_humidity        # ID for humidity sensor
    address: 0x44               # I2C address
    update_interval: never      # Disable automatic updates (manual read only)

  - platform: homeassistant
    name: "Temperature"
    entity_id: sensor.nantes_temperature
    id: temperature
      
  - platform: homeassistant
    name: "TemperatureJ0"
    entity_id: sensor.meteo_jour_nantes
    attribute: temperature0
    id: temperatureJ0
    accuracy_decimals: 1
    on_value:
      then:
        # Refresh the e-paper display whenever this sensor updates
        - component.update: epaper_display      
  - platform: homeassistant
    name: "TemperatureJ1"
    entity_id: sensor.meteo_jour_nantes
    attribute: temperature1
    id: temperatureJ1
    accuracy_decimals: 1
  - platform: homeassistant
    name: "TemperatureJ2"
    entity_id: sensor.meteo_jour_nantes
    attribute: temperature2
    id: temperatureJ2
    accuracy_decimals: 1
  - platform: homeassistant
    name: "TemperatureJ3"
    entity_id: sensor.meteo_jour_nantes
    attribute: temperature3
    id: temperatureJ3
    accuracy_decimals: 1
  - platform: homeassistant
    name: "TemperatureJ4"
    entity_id: sensor.meteo_jour_nantes
    attribute: temperature4
    id: temperatureJ4
    accuracy_decimals: 1            
  - platform: homeassistant
    name: "TemplowJ0"
    entity_id: sensor.meteo_jour_nantes
    attribute: templow0
    id: templowJ0
    accuracy_decimals: 1
  - platform: homeassistant
    name: "TemplowJ1"
    entity_id: sensor.meteo_jour_nantes
    attribute: templow1
    id: templowJ1
    accuracy_decimals: 1
  - platform: homeassistant
    name: "TemplowJ2"
    entity_id: sensor.meteo_jour_nantes
    attribute: templow2
    id: templowJ2
    accuracy_decimals: 1
  - platform: homeassistant
    name: "TemplowJ3"
    entity_id: sensor.meteo_jour_nantes
    attribute: templow3
    id: templowJ3
    accuracy_decimals: 1
  - platform: homeassistant
    name: "TemplowJ4"
    entity_id: sensor.meteo_jour_nantes
    attribute: templow4
    id: templowJ4
    accuracy_decimals: 1            
  - platform: homeassistant
    name: "Temperature0"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature0
    id: temperature0
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature1"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature1
    id: temperature1
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature2"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature2
    id: temperature2
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature3"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature3
    id: temperature3
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature4"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature4
    id: temperature4
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature5"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature5
    id: temperature5
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature6"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature6
    id: temperature6
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature7"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature7
    id: temperature7
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature8"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature8
    id: temperature8
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature9"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature9
    id: temperature9
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature10"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature10
    id: temperature10
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Temperature11"
    entity_id: sensor.meteo_heure_nantes
    attribute: temperature11
    id: temperature11
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation0"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation0
    id: precipitation0
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation1"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation1
    id: precipitation1
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation2"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation2
    id: precipitation2
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation3"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation3
    id: precipitation3
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation4"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation4
    id: precipitation4
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation5"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation5
    id: precipitation5
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation6"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation6
    id: precipitation6
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation7"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation7
    id: precipitation7
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation8"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation8
    id: precipitation8
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation9"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation9
    id: precipitation9
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation10"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation10
    id: precipitation10
    accuracy_decimals: 1

  - platform: homeassistant
    name: "Precipitation11"
    entity_id: sensor.meteo_heure_nantes
    attribute: precipitation11
    id: precipitation11
    accuracy_decimals: 1


font:
  - file: "gfonts://Inter@700"
    id: myFont14
    size: 14
  - file: "gfonts://Inter@700"
    id: myFont16
    size: 16    
  - file: "gfonts://Inter@700"
    id: myFont22
    size: 22      
  - file: "fonts/materialdesignicons-webfont.ttf"
    id: icon_font_22
    size: 22    
    glyphs:
      - "\U000F058E" # Humidity          
  - file: "gfonts://Inter@700"
    id: myFont44
    size: 44        
  - file: "fonts/materialdesignicons-webfont.ttf"
    id: icon_font_50
    size: 50
    glyphs:
      - "\U000F0590" # weather-cloudy - Nuageux
      - "\U000F0591" # weather-fog - Brouillard
      - "\U000F0592" # weather-hail - Grele      
      - "\U000F0593" # weather-lightning - Orage
      - "\U000F0594" # weather-clear-night - Nuit claire
      - "\U000F0595" # weather-partly-cloudy - Partiellement nuageux
      - "\U000F0596" # weather-pouring - Pluie forte
      - "\U000F0597" # weather-rainy - Pluie
      - "\U000F0598" # weather-snowy - Neige
      - "\U000F0599" # weather-sunny - Soleil
      - "\U000F0F30" # weather-hazy - brume
      - "\U000F0F31" # weather-night-partly-cloudy - Nuit partiellement nuageuse
      - "\U000F0F32" # weather-partly-lightning - Orage partiel
      - "\U000F0F33" # weather-partly-rainy - Pluie partielle
      - "\U000F0F34" # weather-partly-snowy - Neige partielle
      - "\U000F0F35" # weather-partly-snowy-rainy -Neige pluie partielle
      - "\U000F0F36" # weather-snowy-heavy - Neige forte
      - "\U000F059D" # weather-windy - Vent
      - "\U000F067E" # weather-lightning-rainy - Orage pluie
      - "\U000F059E" # weather-windy-variant - Vent variante
      - "\U000F0F2F" # weather-exceptional - Exceptionnel    
      - "\U000F18D7"  # température extérieure (sun-thermometer)
      - "\U000F0F55"  # température intérieure (home-thermometer)     
      - "\U000F058E"  # humidite (water-percent)     
      

  - file: "fonts/materialdesignicons-webfont.ttf"
    id: icon_font_80
    size: 80
    glyphs:
      - "\U000F0590" # weather-cloudy - Nuageux
      - "\U000F0591" # weather-fog - Brouillard
      - "\U000F0592" # weather-hail - Grele      
      - "\U000F0593" # weather-lightning - Orage
      - "\U000F0594" # weather-clear-night - Nuit claire
      - "\U000F0595" # weather-partly-cloudy - Partiellement nuageux
      - "\U000F0596" # weather-pouring - Pluie forte
      - "\U000F0597" # weather-rainy - Pluie
      - "\U000F0598" # weather-snowy - Neige
      - "\U000F0599" # weather-sunny - Soleil
      - "\U000F0F30" # weather-hazy - brume
      - "\U000F0F31" # weather-night-partly-cloudy - Nuit partiellement nuageuse
      - "\U000F0F32" # weather-partly-lightning - Orage partiel
      - "\U000F0F33" # weather-partly-rainy - Pluie partielle
      - "\U000F0F34" # weather-partly-snowy - Neige partielle
      - "\U000F0F35" # weather-partly-snowy-rainy -Neige pluie partielle
      - "\U000F0F36" # weather-snowy-heavy - Neige forte
      - "\U000F059D" # weather-windy - Vent
      - "\U000F067E" # weather-lightning-rainy - Orage pluie
      - "\U000F059E" # weather-windy-variant - Vent variante
      - "\U000F0F2F" # weather-exceptional - Exceptionnel
  
  - file: "fonts/materialdesignicons-webfont.ttf"
    id: icon_font_20
    size: 20
    glyphs:
      - "\U000F12A3" # battery
      - "\U000F058C" # water
      - "\U000F050F" # thermometer
      - "\U000F1442" # clock
      
# Deep sleep configuration to save power
deep_sleep:
  id: deep_sleep_1              # ID for deep sleep component
  run_duration: 30s             # Time to stay awake after wake-up
  sleep_duration: 30min         # Time to sleep between wake-ups
  wakeup_pin: GPIO3             # GPIO pin to wake up device
  wakeup_pin_mode: INVERT_WAKEUP # Inverted wake-up logic

spi:
  clk_pin: GPIO7
  mosi_pin: GPIO9

display:
  - platform: waveshare_epaper
    id: epaper_display
    model: 7.50inv2
    cs_pin: GPIO10
    dc_pin: GPIO11
    reset_pin:
      number: GPIO12
      inverted: false
    busy_pin:
      number: GPIO13
      inverted: true
    update_interval: never

    lambda: |-

      const char* icon;
      int base_x, base_y;
      int text_width;
      int x_offset;
      int baseline;
      int height;

      // Vérification avant affichage
      if (!id(temperatureJ0).has_state()) {
        it.printf(0, 0, id(myFont22), "Attente des donnees meteo...");
        return;
      }

      // DATE
      // ----
      char buffer[25];      
      base_y = 5;
      const char* jours[] = {"Dimanche", "Lundi", "Mardi", "Mercredi", "Jeudi", "Vendredi", "Samedi"};
      const char* mois[]  = {"janvier", "février", "mars", "avril", "mai", "juin", "juillet", "août", "septembre", "octobre", "novembre", "decembre"};
      auto t = id(mon_time).now();
      if (t.is_valid()) {
        int index = t.day_of_week % 7;
        snprintf(buffer, sizeof(buffer), "%s %d %s", jours[(t.day_of_week % 7)-1], t.day_of_month, mois[t.month - 1]);
        id(myFont44).measure(buffer, &text_width, &x_offset, &baseline, &height);

        // Calcul de la position X pour centrer le texte
        base_x = (800 - text_width) / 2;        
        it.printf(base_x, base_y, id(myFont44), "%s", buffer);
      }

      // TEMPERATURES INTERIEURE EXTERIEURE
      // ----------------------------------
      base_x = 10;
      base_y = 90;

      it.printf(base_x, base_y, id(icon_font_50), "\U000F18D7");
      it.printf(base_x+60, base_y, id(myFont44), "%.1f°", id(temperature).state);
      it.printf(base_x, base_y+70, id(icon_font_50), "\U000F0F55");
      it.printf(base_x+60, base_y+70, id(myFont44), "%.1f°", id(sht4x_temperature).state-1); // Calibration à -1°C 
      it.printf(base_x, base_y+140, id(icon_font_50), "\U000F058E");
      it.printf(base_x+60, base_y+140, id(myFont44), "%.0f%%", id(sht4x_humidity).state);


      // ZONE PREVISIONS QUOTIDIENNES
      // ----------------------------
      // Liste des jours
      std::string jour_jours[5] = {
        id(jour0).state,
        id(jour1).state,
        id(jour2).state,
        id(jour3).state,
        id(jour4).state
      };

      // Liste des temperatures maximales quotidiennes
      float temperature_max_jours[5] = {
        id(temperatureJ0).state,
        id(temperatureJ1).state,
        id(temperatureJ2).state,
        id(temperatureJ3).state,
        id(temperatureJ4).state
      };      
      // Liste des temperatures minimales quotidiennes
      float temperature_min_jours[5] = {
        id(templowJ0).state,
        id(templowJ1).state,
        id(templowJ2).state,
        id(templowJ3).state,
        id(templowJ4).state
      };            
      
      // Liste des conditions quotidiennes
      std::string condition_jours[5] = {
        id(conditionJ0).state,
        id(conditionJ1).state,
        id(conditionJ2).state,
        id(conditionJ3).state,
        id(conditionJ4).state
      };

      for (int i = 0; i < 5; i++) {
        if (condition_jours[i] == "sunny") {
          icon = "\U000F0599"; // soleil
        } else if (condition_jours[i] == "partlycloudy") {
          icon = "\U000F0595"; // partiellement nuageux
        } else if (condition_jours[i] == "cloudy") {
          icon = "\U000F0590"; // nuageux
        } else if (condition_jours[i] == "rainy") {
          icon = "\U000F0597"; // pluie
        } else if (condition_jours[i] == "snowy") {
          icon = "\U000F0598"; // neige
        } else if (condition_jours[i] == "pouring") {
          icon = "\U000F0596"; // pluie forte          
        } else if (condition_jours[i] == "lightning") {
          icon = "\U000F0593"; // orage          
        } else if (condition_jours[i] == "clear-night") {
          icon = "\U000F0594"; // nuit claire  
        } else if (condition_jours[i] == "night-partlycloudy") {
          icon = "\U000F0F31"; // nuit partiellement nuageuse      
        } else if (condition_jours[i] == "fog") {
          icon = "\U000F0591"; // brouillard      
        } else if (condition_jours[i] == "hail") {
          icon = "\U000F0592"; // grele    
        } else if (condition_jours[i] == "lightning-rainy") {
          icon = "\U000F067E"; // orage pluie                   
        } else if (condition_jours[i] == "snowy-rainy") {
          icon = "\U000F0F35"; // neige pluie                     
        } else if (condition_jours[i] == "windy") {
          icon = "\U000F059D"; // vent         
        } else if (condition_jours[i] == "windy-variant") {
          icon = "\U000F059E"; // vent                                                 
        } else if (condition_jours[i] == "exceptional") {
          icon = "\U000F0F2F"; // exceptionnel       
        } else {                
          icon = "\U000F0F2F"; // défaut 
        }


        // Calcul de la position X pour centrer le texte
        base_x = 220 + 116*i;
        base_y = 90;
        id(myFont22).measure(jour_jours[i].c_str(), &text_width, &x_offset, &baseline, &height);
        int x_jour = base_x + (116 - text_width) / 2; 
        id(icon_font_80).measure(icon, &text_width, &x_offset, &baseline, &height);
        int x_icon = base_x + (116 - text_width) / 2; 
        snprintf(buffer, sizeof(buffer), "%.0f", temperature_max_jours[i]);
        id(myFont22).measure(buffer, &text_width, &x_offset, &baseline, &height);
        int x_temp_max = base_x + (116 - text_width) / 2; 
        snprintf(buffer, sizeof(buffer), "%.0f", temperature_min_jours[i]);
        id(myFont22).measure(buffer, &text_width, &x_offset, &baseline, &height);
        int x_temp_min = base_x + (116 - text_width) / 2; 
        it.printf(x_jour, base_y, id(myFont22), "%s", jour_jours[i].c_str());
        it.printf(x_icon, base_y+40, id(icon_font_80), "%s", icon);
        it.printf(x_temp_max, base_y+130, id(myFont22), "%.0f°", temperature_max_jours[i]);
        it.printf(x_temp_min, base_y+160, id(myFont22), "%.0f°", temperature_min_jours[i]);        
      }
    

      // ZONE PREVISIONS HORAIRES
      // Liste des heures)
      std::string heure_values[12] = {
        id(heure0).state,
        id(heure1).state,
        id(heure2).state,
        id(heure3).state,
        id(heure4).state,
        id(heure5).state,
        id(heure6).state,
        id(heure7).state,
        id(heure8).state,
        id(heure9).state,
        id(heure10).state,
        id(heure11).state
      };

      // Liste des Precipitations
      float precipitation_values[12] = {
        id(precipitation0).state,
        id(precipitation1).state,
        id(precipitation2).state,
        id(precipitation3).state,
        id(precipitation4).state,
        id(precipitation5).state,
        id(precipitation6).state,
        id(precipitation7).state,
        id(precipitation8).state,
        id(precipitation9).state,
        id(precipitation10).state,
        id(precipitation11).state
      };

      // Liste des Temperatures
      float temperature_values[12] = {
        id(temperature0).state,
        id(temperature1).state,
        id(temperature2).state,
        id(temperature3).state,
        id(temperature4).state,
        id(temperature5).state,
        id(temperature6).state,
        id(temperature7).state,
        id(temperature8).state,
        id(temperature9).state,
        id(temperature10).state,
        id(temperature11).state
      };      
      
      // Liste des conditions
      std::string condition_values[12] = {
        id(condition0).state,
        id(condition1).state,
        id(condition2).state,
        id(condition3).state,
        id(condition4).state,
        id(condition5).state,
        id(condition6).state,
        id(condition7).state,
        id(condition8).state,
        id(condition9).state,
        id(condition10).state,
        id(condition11).state
      };

      base_x = 10;
      base_y = 310;
      it.printf(base_x, base_y+60, id(icon_font_20), "\U000F1442");  // heure
      it.printf(base_x, base_y+85, id(icon_font_20), "\U000F050F");  // temperature
      it.printf(base_x, base_y+110, id(icon_font_20), "\U000F058C"); // precipication

      for (int i = 0; i < 12; i++) {
        if (condition_values[i] == "sunny") {
          icon = "\U000F0599"; // soleil
        } else if (condition_values[i] == "partlycloudy") {
          icon = "\U000F0595"; // partiellement nuageux
        } else if (condition_values[i] == "cloudy") {
          icon = "\U000F0590"; // nuageux
        } else if (condition_values[i] == "rainy") {
          icon = "\U000F0597"; // pluie
        } else if (condition_values[i] == "snowy") {
          icon = "\U000F0598"; // neige
        } else if (condition_values[i] == "pouring") {
          icon = "\U000F0596"; // pluie forte          
        } else if (condition_values[i] == "lightning") {
          icon = "\U000F0593"; // orage          
        } else if (condition_values[i] == "clear-night") {
          icon = "\U000F0594"; // nuit claire  
        } else if (condition_values[i] == "night-partlycloudy") {
          icon = "\U000F0F31"; // nuit partiellement nuageuse      
        } else if (condition_values[i] == "fog") {
          icon = "\U000F0591"; // brouillard      
        } else if (condition_values[i] == "hail") {
          icon = "\U000F0592"; // grele    
        } else if (condition_values[i] == "lightning-rainy") {
          icon = "\U000F067E"; // orage pluie                   
        } else if (condition_values[i] == "snowy-rainy") {
          icon = "\U000F0F35"; // neige pluie                     
        } else if (condition_values[i] == "windy") {
          icon = "\U000F059D"; // vent         
        } else if (condition_values[i] == "windy-variant") {
          icon = "\U000F059E"; // vent                                                 
        } else if (condition_values[i] == "exceptional") {
          icon = "\U000F0F2F"; // exceptionnel       
        } else {                
          icon = "\U000F0F2F"; // défaut 
        }

      base_x = 50 + 60*i;
      // icon_heure
      id(icon_font_50).measure(icon, &text_width, &x_offset, &baseline, &height);
      int x_icon = base_x + (60 - text_width) / 2;       
      it.printf(x_icon, base_y, id(icon_font_50), "%s", icon);
      // heure
      id(myFont16).measure(heure_values[i].c_str(), &text_width, &x_offset, &baseline, &height);
      int x_heure = base_x + (60 - text_width) / 2; 
      it.printf(x_heure, base_y+60, id(myFont16), "%s", heure_values[i].c_str());
      // temperature
      snprintf(buffer, sizeof(buffer), "%.0f", temperature_values[i]);
      id(myFont16).measure(buffer, &text_width, &x_offset, &baseline, &height);
      int x_temp = base_x + (60 - text_width) / 2; 
      it.printf(x_temp, base_y+85, id(myFont16), "%.0f°", temperature_values[i]);
      // precipication
      snprintf(buffer, sizeof(buffer), "%.1f", precipitation_values[i]);
      id(myFont16).measure(buffer, &text_width, &x_offset, &baseline, &height);
      int x_precip = base_x + (60 - text_width) / 2; 
      it.printf(x_precip, base_y+110, id(myFont16), "%.1f", precipitation_values[i]);
      }   

      // BATTERIE
      it.printf(730, 450, id(icon_font_20), "\U000F12A3");
      it.printf(750, 452, id(myFont14), "%.1fV", id(battery_voltage).state);

      

